<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>随机森林 LTV 预测分析报告</title>
    <style>
        body {
            font-family: "Microsoft YaHei", SimHei, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }
        .container {
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            max-width: 1000px;
            margin: 0 auto;
        }
        h1, h2, h3 {
            color: #333;
        }
        table {
            width: 80%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        img {
            max-width: 100%;
            height: auto;
            margin: 20px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        pre {
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            padding: 15px;
            overflow-x: auto;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>随机森林 (Random Forest) LTV 预测分析报告</h1>

        <h2>1. 分析概述</h2>
        <p>本次分析使用 <strong>随机森林 (Random Forest)</strong> 算法替代原有的线性回归模型，对客户生命周期价值 (LTV) 进行预测。目的是评估随机森林在该任务上的性能，并与线性回归模型进行比较。</p>

        <h2>2. 模型性能评估</h2>
        <h3>2.1 R&sup2; 分数比较</h3>
        <table>
            <thead>
                <tr>
                    <th>模型</th>
                    <th>训练集 R&sup2;</th>
                    <th>测试集 R&sup2;</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>线性回归 (原模型)</td>
                    <td>0.6187</td>
                    <td>0.4778</td>
                </tr>
                <tr>
                    <td>随机森林 (新模型)</td>
                    <td>0.9169</td>
                    <td>0.5899</td>
                </tr>
            </tbody>
        </table>

        <h3>2.2 性能分析</h3>
        <ul>
            <li><strong>绝对性能</strong>: 随机森林在测试集上的 R&sup2; 分数为 <strong>0.5899</strong>。</li>
            <li><strong>相对性能提升</strong>: 与原线性回归模型的测试集 R&sup2; 分数 (0.4778) 相比，随机森林带来了 <strong>0.1121</strong> 的 R&sup2; 分数提升。这表明随机森林模型在解释 LTV 变异性方面有显著改进。</li>
            <li><strong>过拟合风险</strong>: 随机森林的训练集 R&sup2; (0.9169) 远高于测试集 R&sup2; (0.5899)，表明模型可能存在一定程度的过拟合。尽管如此，其测试集性能仍然优于线性回归。</li>
        </ul>

        <h2>3. 预测效果可视化</h2>
        <p>下图展示了随机森林模型在测试集上的预测值与实际值的散点图。点越靠近对角线，预测越准确。</p>
        <img src="rf_prediction_plot.png" alt="随机森林: 实际值 vs. 预测值">

        <h2>4. 特征重要性分析</h2>
        <p>随机森林模型提供了一个非常有价值的洞察：各输入特征对预测结果的相对重要性。</p>
        <table>
            <thead>
                <tr>
                    <th>特征</th>
                    <th>重要性分数</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>M值 (消费金额)</td>
                    <td>0.7853</td>
                </tr>
                <tr>
                    <td>F值 (消费频率)</td>
                    <td>0.1447</td>
                </tr>
                <tr>
                    <td>R值 (最近消费距今时间)</td>
                    <td>0.0700</td>
                </tr>
            </tbody>
        </table>

        <h3>4.1 结论</h3>
        <ul>
            <li><strong>M值 (消费金额)</strong> 是预测年度 LTV 最重要的特征，其重要性远超其他两个特征。这符合直观认知，即历史消费总额是未来消费潜力的强指标。</li>
            <li><strong>F值 (消费频率)</strong> 是第二重要的特征，表明消费活跃度也是一个关键因素。</li>
            <li><strong>R值 (最近消费距今时间)</strong> 的重要性相对较低，但它仍然提供了关于客户流失风险的有用信息。</li>
        </ul>
        
        <h2>5. 特征重要性图</h2>
        <p>以下条形图直观地展示了各特征的重要性排序。</p>
        <img src="rf_feature_importance.png" alt="随机森林特征重要性">

        <h2>6. 总结与后续步骤</h2>
        <ul>
            <li><strong>结论</strong>: 使用随机森林算法成功地提升了 LTV 预测的性能。R&sup2; 分数的提升证明了该模型在处理当前 RFM 特征集时的有效性。</li>
            <li><strong>后续步骤</strong>:
                <ol>
                    <li><strong>超参数调优</strong>: 对 <code>RandomForestRegressor</code> 的参数（如 <code>n_estimators</code>, <code>max_depth</code>, <code>min_samples_split</code> 等）进行网格搜索或随机搜索，以进一步优化模型性能并减少过拟合。</li>
                    <li><strong>特征工程</strong>: 根据 <code>model_improvement_plan.md</code> 和 <code>rf_analysis_plan.md</code> 中的建议，创建新的衍生特征（如平均订单价值 AOV、消费频率密度等），并重新训练模型，观察性能是否能进一步提升。</li>
                    <li><strong>尝试其他模型</strong>: 在特征工程的基础上，可以尝试其他强大的集成学习模型，如 XGBoost 或 LightGBM，比较它们的性能。</li>
                </ol>
            </li>
        </ul>
        <p>总而言之，随机森林是一个非常适合此 LTV 预测任务的模型，显著优于简单的线性回归，并提供了对特征贡献度的清晰理解。</p>

    </div>
</body>
</html>